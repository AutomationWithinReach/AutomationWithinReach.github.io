<!doctype html>
<html lang="en">
  <head>
    <title>&lt;model-viewer&gt; AWR</title>
    <meta charset="utf-8">
    <meta name="description" content="&lt;model-viewer&gt; template">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link type="text/css" href="./styles.css" rel="stylesheet"/>
  </head>

  <style>
  .hotspot{
    display: block;
    width: 20px;
    height: 20px;
    border-radius: 10px;
    border: none;
    background-color: blue;
    box-sizing: border-box;
    pointer-events: none;
     --min-hotspot-opacity: 0.2;
    background-color: green;
  }
    
  .annotation{
    background-color: #888888;
    position: absolute;
    transform: translate(10px, 10px);
    border-radius: 10px;
    padding: 10px;
  }
  .hidden-hotspot{
    display: none;
  }

  .hidden-hotspot[slot="hotspot-1"]{
    display: none;
  }

  .hidden-annotation{
    display: none;
  }
  /* This keeps child nodes hidden while the element loads */
  :not(:defined) > * {
    display: none;
  }
</style>
  <body>

     <div id="qr-code" class="con">
         <img class="qr" src="qr-code.png">
          <img class="awr" src="awr-logo.png">
      </div>

    <div class="txt">   Scan The QR Code To View This Model In Your Space</div>
  
    
  <!-- <model-viewer> HTML element -->
<model-viewer id="dimension-demo" poster="awr-logo.png" loading="auto" reveal="auto" src="models/5002752_REV-A - MultiGrip Top Jaws OD 1.5.glb" ar ar-modes="webxr scene-viewer quick-look" camera-controls tone-mapping="commerce" shadow-intensity="1">
  <button slot="hotspot-dot+X-Y+Z" class="dot" data-position="1 -1 1" data-normal="1 0 0"></button>
  <button slot="hotspot-dim+X-Y" class="dim" data-position="1 -1 0" data-normal="1 0 0"></button>
  <button slot="hotspot-dot+X-Y-Z" class="dot" data-position="1 -1 -1" data-normal="1 0 0"></button>
  <button slot="hotspot-dim+X-Z" class="dim" data-position="1 0 -1" data-normal="1 0 0"></button>
  <button slot="hotspot-dot+X+Y-Z" class="dot" data-position="1 1 -1" data-normal="0 1 0"></button>
  <button slot="hotspot-dim+Y-Z" class="dim" data-position="0 -1 -1" data-normal="0 1 0"></button>
  <button slot="hotspot-dot-X+Y-Z" class="dot" data-position="-1 1 -1" data-normal="0 1 0"></button>
  <button slot="hotspot-dim-X-Z" class="dim" data-position="-1 0 -1" data-normal="-1 0 0"></button>
  <button slot="hotspot-dot-X-Y-Z" class="dot" data-position="-1 -1 -1" data-normal="-1 0 0"></button>
  <button slot="hotspot-dim-X-Y" class="dim" data-position="-1 -1 0" data-normal="-1 0 0"></button>
  <button slot="hotspot-dot-X-Y+Z" class="dot" data-position="-1 -1 1" data-normal="-1 0 0"></button>
  <svg id="dimLines" width="100%" height="100%" xmlns="http://www.w3.org/2000/svg" class="dimensionLineContainer">
    <line class="dimensionLine"></line>
    <line class="dimensionLine"></line>
    <line class="dimensionLine"></line>
    <line class="dimensionLine"></line>
    <line class="dimensionLine"></line>
  </svg>

   <button id="spot-1" class="Hotspot" slot="hotspot-1" data-position="0.05786554385311728m 0.007757613450444567m 0.023007202807698676m" data-normal="0m -0.9135455240053287m 0.40673649402264017m" data-visibility-attribute="visible">
      <div id="ant-1" class="annotation">Pin</div></button>

  <button id="spot-2" class="hotspot" slot="hotspot-2" data-position="-0.09734240527673425m 0.0262101703867281m -0.15093502150734436m" data-normal="0.07682772510565983m 0.7320471744388427m 0.676907996001817m" data-visibility-attribute="visible">
    <div id="ant-2" class="annotation">Cable</div></button>
  <button id="spot-3" class="hotspot" slot="hotspot-3" data-position="0.101627573502076m 0.03607742650354882m 0.0524533974302679m" data-normal="0.013688486500912792m 0.7323856645092087m 0.6807524247174733m" data-visibility-attribute="visible">
    <div id="ant-3" class="annotation">Cable</div></button>
  <button id="spot-4" class="hotspot" slot="hotspot-4" data-position="-0.10946019368523606m 0.018621422624973582m 0.05238528726072122m" data-normal="-0.13879278587959348m -0.36119009056098345m 0.9221053524778662m" data-visibility-attribute="visible">
    <div id="ant-4" class="annotation">Cable</div></button>
  <button id="spot-5" class="hotspot" slot="hotspot-5" data-position="0.10929127842218712m 0.008000000325801828m -0.1967828224041498m" data-normal="0m 0.9999999999999996m -3.4228542950295595e-8m" data-visibility-attribute="visible">
    <div id="ant-5" class="annotation">Connector</div></button>
  <button id="spot-6" class="hotspot" slot="hotspot-6" data-position="0.3830203582337416m 0.1252708937724909m -0.1402656203263934m" data-normal="-3.4228542950295595e-8m 0m 0.9999999999999996m" data-visibility-attribute="visible">
    <div id="ant-6" class="annotation">Reflector</div></button>
  <button id="spot-7" class="hotspot" slot="hotspot-7" data-position="0.39056465018319003m 0.13104690284091602m 0.012134375296085492m" data-normal="-3.4228542950295595e-8m 0m 0.9999999999999996m" data-visibility-attribute="visible">
    <div id="ant-7" class="annotation">Reflector</div></button>
  <button id="spot-8" class="hotspot" slot="hotspot-8" data-position="-0.37529049612855975m 0.016349999286961958m -0.14461649789758635m" data-normal="3.4228542950295595e-8m 0.9999999999999996m 0m" data-visibility-attribute="visible">
    <div id="ant-8" class="annotation">Laser</div></button>
  <button id="spot-9" class="hotspot" slot="hotspot-9" data-position="-0.3791986552651861m 0.016349999420732328m 0.01101612081876674m" data-normal="3.4228542950295595e-8m 0.9999999999999996m 0m" data-visibility-attribute="visible">
    <div id="ant-9" class="annotation">Laser</div></button>
  <button id="spot-10" class="hotspot" slot="hotspot-10" data-position="-0.7679901709730681m 0.05488477826430671m 0.004960939288139343m" data-normal="0m 0m 1m" data-visibility-attribute="visible">
    <div id="ant-10" class="annotation">Box</div></button>
  <button id="spot-11" class="hotspot" slot="hotspot-11" data-position="-0.8174355049505166m 0.03175000101327896m 0.20116408143992892m" data-normal="0m 1m 0m" data-visibility-attribute="visible">
    <div id="ant-11" class="annotation">Expansion Foam</div></button>

  <div id="controls" class="dim">
    <label for="src">Product:</label>
    <select id="src" class="src_sel">
      <option value="models/5002752_REV-A - MultiGrip Top Jaws OD 1.5.glb">5002752_MultiGrip Top Jaw, OD 1.5" tall</option>
      <option value="models/5004015.glb">5004015_MultiGrip FIXED Jaw, OD 1.5" tall</option>
      <option value="models/5004027_REV-A-MultiGripBaseJawsOD.glb">5004027_MultiGrip Base Jaw</option>
      <option value="models/5006795 - REV-A - MultiGrip Top Jaws OD 2.0.glb">5006795_MultiGrip Top Jaw, OD 2.0" tall</option>
      <option value="models/5006796_REV-A - MultiGrip Top Jaws OD 1.0.glb">5006796_MultiGrip Top Jaw, OD 1.0" tall</option>
      <option value="models/5007344.glb">5007344_MultiGrip FIXED Jaw, ID 1.5" tall</option>
      <option value="models/5007394_REV-A - MultiGrip Top Jaws OD 1.5 - Oversized.glb">5007394_MultiGrip Oversized Top Jaw, OD, 10" wide x 8" long</option>
      <option value="models/5009398 - REV-A - MultiGrip Top Jaws OD 3.0_CM.glb">5009398_MultiGrip Top Jaw, OD 3.0" tall</option>
      <option value="models/3IN DC DRAWER TEMPLATE (LG-3INTRAYKIT-00).glb">LG-3INTRAYKIT-00</option>
      <option value="models/8IN DC DRAWER TEMPLATE (LG-8INTRAYKIT-00).glb">LG-8INTRAYKIT-00</option>
      <option value="models/AWR-ROBOT-1DOOR-KIT.glb">AWR-ROBOT-1DOOR-KIT</option>
      <option value="models/RC-6INTEMPLATEKIT.glb">RC-6INTEMPLATEKIT</option>
      <option value="models/AWR-00096.glb">AWR-00096</option>
      <option value="models/AWR-00097.glb">AWR-00097</option>
      <option value="models/AWR-00098.glb">AWR-00098</option>
      <option value="models/LG-VISEKIT-00.glb">LG-VISEKIT-00</option>
      <option value="models/LG-VBX-M460-ATCD-00-00.glb">LG-VBX-M460-ATCD-00-00</option>
      <option value="models/AWR-1SENSOR-DOOR1.glb">AWR-1SENSOR-DOOR</option>
      <option value="models/AWR-2SENSOR-DOOR.glb">AWR-2SENSOR-DOOR</option>
    </select><br>

    <label for="show-dimensions">Show Annotations:</label>
    <input id="show-dimensions" type="checkbox" checked="true">

    <label for="unit">Units:</label>
    <select id="unit" class="unit">
      <option value="metric">Metric</option>
      <option value="imperial">Imperial</option>
    </select><br>
  </div>
 
  
</model-viewer>
 <script src="script.js"></script>
    <!-- Loads <model-viewer> for browsers: -->
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.2.0/model-viewer.min.js"></script>

     <div class="progress-bar hide" slot="progress-bar">
          <div class="update-bar"></div>
      </div>
  </body>

  <script>
const modelViewerParameters = document.querySelector("model-viewer#dimension-demo");

modelViewerParameters.addEventListener("load", (ev) => {
    
  let material = modelViewerParameters.model.materials[0];

  material.pbrMetallicRoughness.setBaseColorFactor("#a2a4a6");
  
  material.pbrMetallicRoughness.setMetallicFactor(0.8);
  material.pbrMetallicRoughness.setRoughnessFactor(0.2);

});

</script>
    
<script type="module">
  const modelViewer = document.querySelector('#dimension-demo');

  var ready = false;

  modelViewer.querySelector('#src').addEventListener('input', (event) => {
    modelViewer.src = event.target.value;
  });
  
   modelViewer.querySelector('.unit').addEventListener('input', (event) => {
    var s = document.getElementById("src").value;
    console.log(s)
    ready = false;
    
   setTimeout(() => {
      modelViewer.setAttribute('src', s);
   }, "100");
     
   modelViewer.setAttribute('src', "awr-logo.glb")
    
  });
  
  const checkbox = modelViewer.querySelector('#show-dimensions');

  const dimElements = [...modelViewer.querySelectorAll('button'), modelViewer.querySelector('#dimLines')];
  
  function setVisibility(visible) {
    dimElements.forEach((element) => {
      if (visible) {
        element.classList.remove('hide');
      } else {
        element.classList.add('hide');
      }
    });
  }
  
  checkbox.addEventListener('change', () => {
    setVisibility(checkbox.checked);
  });
  
  modelViewer.addEventListener('ar-status', (event) => {
    setVisibility(checkbox.checked && event.detail.status !== 'session-started');
  });

  // update svg
  function drawLine(svgLine, dotHotspot1, dotHotspot2, dimensionHotspot) {
    if (dotHotspot1 && dotHotspot2) {
      svgLine.setAttribute('x1', dotHotspot1.canvasPosition.x);
      svgLine.setAttribute('y1', dotHotspot1.canvasPosition.y);
      svgLine.setAttribute('x2', dotHotspot2.canvasPosition.x);
      svgLine.setAttribute('y2', dotHotspot2.canvasPosition.y);

      // use provided optional hotspot to tie visibility of this svg line to
      if (dimensionHotspot && !dimensionHotspot.facingCamera) {
        svgLine.classList.add('hide');
      }
      else {
        svgLine.classList.remove('hide');
      }
    }
  }

  const dimLines = modelViewer.querySelectorAll('line');

  const renderSVG = () => {
    drawLine(dimLines[0], modelViewer.queryHotspot('hotspot-dot+X-Y+Z'), modelViewer.queryHotspot('hotspot-dot+X-Y-Z'), modelViewer.queryHotspot('hotspot-dim+X-Y'));
    drawLine(dimLines[1], modelViewer.queryHotspot('hotspot-dot+X-Y-Z'), modelViewer.queryHotspot('hotspot-dot+X+Y-Z'), modelViewer.queryHotspot('hotspot-dim+X-Z'));
    drawLine(dimLines[2], modelViewer.queryHotspot('hotspot-dot+X+Y-Z'), modelViewer.queryHotspot('hotspot-dot-X+Y-Z')); // always visible
    drawLine(dimLines[3], modelViewer.queryHotspot('hotspot-dot-X+Y-Z'), modelViewer.queryHotspot('hotspot-dot-X-Y-Z'), modelViewer.queryHotspot('hotspot-dim-X-Z'));
    drawLine(dimLines[4], modelViewer.queryHotspot('hotspot-dot-X-Y-Z'), modelViewer.queryHotspot('hotspot-dot-X-Y+Z'), modelViewer.queryHotspot('hotspot-dim-X-Y'));
  };

  function clearAnnotations() {
    document.getElementById("spot-1").setAttribute('class', "hidden-hotspot");
      document.getElementById("ant-1").setAttribute('class', "hidden-annotation");
    document.getElementById("spot-2").setAttribute('class', "hidden-hotspot");
      document.getElementById("ant-2").setAttribute('class', "hidden-annotation");
    document.getElementById("spot-3").setAttribute('class', "hidden-hotspot");
      document.getElementById("ant-3").setAttribute('class', "hidden-annotation");
    document.getElementById("spot-4").setAttribute('class', "hidden-hotspot");
      document.getElementById("ant-4").setAttribute('class', "hidden-annotation");
    document.getElementById("spot-5").setAttribute('class', "hidden-hotspot");
      document.getElementById("ant-5").setAttribute('class', "hidden-annotation");
    document.getElementById("spot-6").setAttribute('class', "hidden-hotspot");
      document.getElementById("ant-6").setAttribute('class', "hidden-annotation");
    document.getElementById("spot-7").setAttribute('class', "hidden-hotspot");
      document.getElementById("ant-7").setAttribute('class', "hidden-annotation");
    document.getElementById("spot-8").setAttribute('class', "hidden-hotspot");
      document.getElementById("ant-8").setAttribute('class', "hidden-annotation");
    document.getElementById("spot-9").setAttribute('class', "hidden-hotspot");
      document.getElementById("ant-9").setAttribute('class', "hidden-annotation");
    document.getElementById("spot-10").setAttribute('class', "hidden-hotspot");
      document.getElementById("ant-10").setAttribute('class', "hidden-annotation");
    document.getElementById("spot-11").setAttribute('class', "hidden-hotspot");
      document.getElementById("ant-11").setAttribute('class', "hidden-annotation");
  }

  modelViewer.addEventListener('load', () => {
    const center = modelViewer.getBoundingBoxCenter();
    const size = modelViewer.getDimensions();
    const x2 = size.x / 2;
    const y2 = size.y / 2;
    const z2 = size.z / 2;

    clearAnnotations();

    var x = document.getElementById("src").value;
    if(x == "models/5002752_REV-A - MultiGrip Top Jaws OD 1.5.glb"){ 

    }
    if(x == "models/5004015.glb"){
       document.getElementById("spot-1").setAttribute('class', "hotspot");
       document.getElementById("ant-1").setAttribute('class', "annotation");

    }
    if(x == "models/AWR-2SENSOR-DOOR.glb"){

      for (let i = 2; i <= 11; i++) {
        document.getElementById("spot-" + i).setAttribute('class', "hotspot");
        document.getElementById("ant-" + i).setAttribute('class', "annotation");
      }
    }

    var u = document.getElementById("unit").value;
    if(u == "metric"){ 
      
      modelViewer.querySelector('button[slot="hotspot-dim+X-Y"]').textContent =
        `${(size.z * 100).toFixed(0)} cm`;
      modelViewer.querySelector('button[slot="hotspot-dim+X-Z"]').textContent =
        `${(size.y * 100).toFixed(0)} cm`;
       modelViewer.querySelector('button[slot="hotspot-dim+Y-Z"]').textContent =
        `${(size.x * 100).toFixed(0)} cm`;
       modelViewer.querySelector('button[slot="hotspot-dim-X-Z"]').textContent =
        `${(size.y * 100).toFixed(0)} cm`;
       modelViewer.querySelector('button[slot="hotspot-dim-X-Y"]').textContent =
        `${(size.z * 100).toFixed(0)} cm`;
    }
    if(u == "imperial"){

       modelViewer.querySelector('button[slot="hotspot-dim+X-Y"]').textContent =
        `${(size.z * 100 * 0.393701).toFixed(0)} in`;
      modelViewer.querySelector('button[slot="hotspot-dim+X-Z"]').textContent =
        `${(size.y * 100 * 0.393701).toFixed(0)} in`;
       modelViewer.querySelector('button[slot="hotspot-dim+Y-Z"]').textContent =
        `${(size.x * 100 * 0.393701).toFixed(0)} in`;
       modelViewer.querySelector('button[slot="hotspot-dim-X-Z"]').textContent =
        `${(size.y * 100 * 0.393701).toFixed(0)} in`;
       modelViewer.querySelector('button[slot="hotspot-dim-X-Y"]').textContent =
        `${(size.z * 100 * 0.393701).toFixed(0)} in`;
    }
  
    modelViewer.updateHotspot({
      name: 'hotspot-dot+X-Y+Z',
      position: `${center.x + x2} ${center.y - y2} ${center.z + z2}`
    });

    modelViewer.updateHotspot({
      name: 'hotspot-dim+X-Y',
      position: `${center.x + x2 * 1.2} ${center.y - y2 * 1.1} ${center.z}`
    });
   
    modelViewer.updateHotspot({
      name: 'hotspot-dot+X-Y-Z',
      position: `${center.x + x2} ${center.y - y2} ${center.z - z2}`
    });

    modelViewer.updateHotspot({
      name: 'hotspot-dim+X-Z',
      position: `${center.x + x2 * 1.2} ${center.y} ${center.z - z2 * 1.2}`
    });

    modelViewer.updateHotspot({
      name: 'hotspot-dot+X+Y-Z',
      position: `${center.x + x2} ${center.y + y2} ${center.z - z2}`
    });

    modelViewer.updateHotspot({
      name: 'hotspot-dim+Y-Z',
      position: `${center.x} ${center.y + y2 * 1.1} ${center.z - z2 * 1.1}`
    });

    modelViewer.updateHotspot({
      name: 'hotspot-dot-X+Y-Z',
      position: `${center.x - x2} ${center.y + y2} ${center.z - z2}`
    });

    modelViewer.updateHotspot({
      name: 'hotspot-dim-X-Z',
      position: `${center.x - x2 * 1.2} ${center.y} ${center.z - z2 * 1.2}`
    });

    modelViewer.updateHotspot({
      name: 'hotspot-dot-X-Y-Z',
      position: `${center.x - x2} ${center.y - y2} ${center.z - z2}`
    });

    modelViewer.updateHotspot({
      name: 'hotspot-dim-X-Y',
      position: `${center.x - x2 * 1.2} ${center.y - y2 * 1.1} ${center.z}`
    });

    modelViewer.updateHotspot({
      name: 'hotspot-dot-X-Y+Z',
      position: `${center.x - x2} ${center.y - y2} ${center.z + z2}`
    });

    renderSVG();

    modelViewer.addEventListener('camera-change', renderSVG);
    ready = true;
  });
</script>
<style>
  #controls {
    position: absolute;
    bottom: 16px;
    left: 16px;
    max-width: 50%;
    transform: unset;
    pointer-events: auto;
    z-index: 100;
  }

  .ser_sel{
      max-width: 50%;
  }

  .dot{
    display: none;
  }

  .con{
      display: flex;
      width: 100%;
      max-height: 10%;
  }
  .qr{
      display: flex;
      object-fit:contain;
      max-width:10%;
      align-items: flex-start;
      position: relative;
      left: 16px;
  }
  .txt{
      position: relative;
      font-size: larger;
      text-align:left;
      color:green;
      left: 16px;
  }
  .awr{
      display: flex;
      object-fit:contain;
      align-items: flex-end;
      position: relative;
      left: 16px;
  }

  .dim{
    background: #fff;
    border-radius: 4px;
    border: none;
    box-sizing: border-box;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.25);
    color: rgba(0, 0, 0, 0.8);
    display: block;
    font-family: Futura, Helvetica Neue, sans-serif;
    font-size: 1em;
    font-weight: 700;
    max-width: 128px;
    overflow-wrap: break-word;
    padding: 0.5em 1em;
    position: absolute;
    width: max-content;
    height: max-content;
    transform: translate3d(-50%, -50%, 0);
    pointer-events: none;
    --min-hotspot-opacity: 0;
  }

  @media only screen and (max-width: 800px) {
    .dim{
      font-size: 3vw;
    }
  }

  .dimensionLineContainer{
    pointer-events: none;
    display: block;
  }

  .dimensionLine{
    stroke: #16a5e6;
    stroke-width: 2;
    stroke-dasharray: 2;
  }

  .hide{
    display: none;
  }
  /* This keeps child nodes hidden while the element loads */
  :not(:defined) > * {
    display: none;
  }
</style>
</html>
